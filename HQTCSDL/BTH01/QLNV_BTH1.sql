CREATE DATABASE QLNV
GO
USE QLNV
GO

CREATE TABLE PHONG
(
	MAPHONG CHAR(3) PRIMARY KEY,
	TENPHONG NVARCHAR(40),
	DIACHI NVARCHAR(50),
	TEL CHAR(10)
)
CREATE TABLE DMNN
(
	MANN CHAR(2) PRIMARY KEY,
	TENNN NVARCHAR(20)
)
CREATE TABLE NHANVIEN
(
	MANV CHAR(5) PRIMARY KEY,
	HOTEN NVARCHAR(40),
	GIOITINH NVARCHAR(3),
	NGAYSINH DATE,
	LUONG INT,
	MAPHONG CHAR(3),
	SDT CHAR(10),
	NGAYBC DATE,

	FOREIGN KEY (MAPHONG) REFERENCES PHONG(MAPHONG)
)

CREATE TABLE TDNN
(
	MANV CHAR(5),
	MANN CHAR(2),
	TDO CHAR(1),
	PRIMARY KEY (MANV,MANN),
	
	FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV),
	FOREIGN KEY (MANN) REFERENCES DMNN(MANN)
)
GO

INSERT PHONG VALUES ('HCA', N'Hành chính tổ hợp', N'123, Láng Hạ, Đống Đa, Hà Nội', '04 8585793')
INSERT PHONG VALUES ('KDA', N'Kinh Doanh', N'123, Láng Hạ, Đống Đa, Hà Nội', '04 8574943')
INSERT PHONG VALUES ('KTA', N'Kỹ thuật', N'123, Láng Hạ, Đống Đa, Hà Nội', '04 9480485')
INSERT PHONG VALUES ('QTA', N'Quản trị', N'123, Láng Hạ, Đống Đa, Hà Nội', '04 8508585')

INSERT DMNN VALUES ('01', N'Anh')
INSERT DMNN VALUES ('02', N'Nga')
INSERT DMNN VALUES ('03', N'Pháp')
INSERT DMNN VALUES ('04', N'Nhật')
INSERT DMNN VALUES ('05', N'Trung Quốc')
INSERT DMNN VALUES ('06', N'Hàn Quốc')


INSERT NHANVIEN VALUES ('HC001', N'Nguyễn Thị Hà', N'Nữ', '8/27/1950', 2500000, 'HCA', NULL, '2/8/1975')
INSERT NHANVIEN VALUES ('HC002', N'Trần Văn Nam', N'Nam', '6/12/1975', 3000000, 'HCA', NULL, '6/8/1997')
INSERT NHANVIEN VALUES ('HC003', N'Nguyễn Thanh Huyền', N'Nữ', '7/3/1978', 1500000, 'HCA', NULL, '9/24/1999')
INSERT NHANVIEN VALUES ('KD001', N'Lê Tuyết Anh', N'Nữ', '2/3/1977', 2500000, 'KDA', NULL, '10/2/2001')
INSERT NHANVIEN VALUES ('KD002', N'Nguyễn Anh Tú', N'Nam', '7/4/1942', 2600000, 'KDA', NULL, '9/24/1999')
INSERT NHANVIEN VALUES ('KD003', N'Phạm An Thái', N'Nam', '5/9/1977', 1600000, 'KDA', NULL, '9/24/1999')
INSERT NHANVIEN VALUES ('KD004', N'Lê Văn Hải', N'Nam', '1/2/1976', 2700000, 'KDA', NULL, '6/8/1997')
INSERT NHANVIEN VALUES ('KD005', N'Nguyễn Phương Minh', N'Nam', '1/2/1980', 2000000, 'KDA', NULL, '10/2/2001')
INSERT NHANVIEN VALUES ('KT001', N'Tran Dinh Kham', N'Nam', '12/2/1981', 2700000, 'KTA', NULL, '1/1/2005')
INSERT NHANVIEN VALUES ('KT002', N'Nguyễn Mạnh Hùng', N'Nam', '8/16/1980', 2300000, 'KTA', NULL, '1/1/2005')
INSERT NHANVIEN VALUES ('KT003', N'Phạm Thanh Sơn', N'Nam', '8/20/1984', 2000000, 'KTA', NULL, '1/1/2005')
INSERT NHANVIEN VALUES ('KT004', N'Vũ Thị Hoài', N'Nữ', '12/5/1980', 2500000, 'KTA', NULL, '10/2/2001')
INSERT NHANVIEN VALUES ('KT005', N'Nguyễn Thu Lan', N'Nữ', '10/5/1977', 3000000, 'KTA', NULL, '10/2/2001')
INSERT NHANVIEN VALUES ('KT006', N'Trần Hoài Nam', N'Nam', '7/2/1978', 2800000, 'KTA', NULL, '6/8/1997')
INSERT NHANVIEN VALUES ('KT007', N'Hoàng Sơn Nam', N'Nam', '12/3/1940', 3000000, 'KTA', NULL, '7/2/1965')
INSERT NHANVIEN VALUES ('KT008', N'Lê Thu Trang', N'Nữ', '7/6/1950', 2500000, 'KTA', NULL, '8/2/1968')
INSERT NHANVIEN VALUES ('KT009', N'Khúc Nam Hải', N'Nam', '7/22/1980', 2000000, 'KTA', NULL, '1/1/2005')
INSERT NHANVIEN VALUES ('KT010', N'Phùng Trung Dũng', N'Nam', '8/28/1978', 2200000, 'KTA', NULL, '9/24/1999')

INSERT TDNN VALUES ('HC001', '01', 'A')
INSERT TDNN VALUES ('HC001', '02', 'B')
INSERT TDNN VALUES ('HC002', '01', 'C')
INSERT TDNN VALUES ('HC002', '03', 'C')
INSERT TDNN VALUES ('HC003', '01', 'D')
INSERT TDNN VALUES ('KD001', '01', 'C')
INSERT TDNN VALUES ('KD001', '02', 'B')
INSERT TDNN VALUES ('KD002', '01', 'D')
INSERT TDNN VALUES ('KD002', '02', 'A')
INSERT TDNN VALUES ('KD003', '01', 'B')
INSERT TDNN VALUES ('KD003', '02', 'C')
INSERT TDNN VALUES ('KD004', '01', 'C')
INSERT TDNN VALUES ('KD004', '04', 'A')
INSERT TDNN VALUES ('KD004', '05', 'A')
INSERT TDNN VALUES ('KD005', '01', 'B')
INSERT TDNN VALUES ('KD005', '02', 'D')
INSERT TDNN VALUES ('KD005', '03', 'B')
INSERT TDNN VALUES ('KD005', '04', 'B')
INSERT TDNN VALUES ('KT001', '01', 'D')
INSERT TDNN VALUES ('KT001', '04', 'E')
INSERT TDNN VALUES ('KT002', '01', 'C')
INSERT TDNN VALUES ('KT002', '02', 'B')
INSERT TDNN VALUES ('KT003', '01', 'D')
INSERT TDNN VALUES ('KT003', '03', 'C')
INSERT TDNN VALUES ('KT004', '01', 'D')
INSERT TDNN VALUES ('KT005', '01', 'C')
GO

---USE master DROP DATABASE QLNV

-- 1
SELECT * FROM NHANVIEN WHERE MANV = 'KT001'
-- 2
UPDATE NHANVIEN SET HOTEN = N'Trần Đình Khảm' WHERE MANV = 'KT001'
-- 3
SELECT * FROM NHANVIEN WHERE GIOITINH = N'Nữ'
-- 4
SELECT * FROM NHANVIEN WHERE HOTEN LIKE N'Nguyễn%'
-- 5
SELECT * FROM NHANVIEN WHERE HOTEN LIKE N'%Văn%'
-- 6
SELECT *, YEAR(GETDATE()) - YEAR(NGAYSINH) AS [Tuổi]   FROM NHANVIEN WHERE YEAR(GETDATE()) - YEAR(NGAYSINH) < 30
-- 7
SELECT *, YEAR(GETDATE()) - YEAR(NGAYSINH) AS [Tuổi] FROM NHANVIEN WHERE YEAR(GETDATE()) - YEAR(NGAYSINH) BETWEEN 25 AND 30
-- 8
SELECT MANV FROM TDNN WHERE MANN = '01' AND TDO >= 'C'
-- 9
SELECT * FROM NHANVIEN WHERE YEAR(NGAYBC) < 2000
-- 10
SELECT *, YEAR(GETDATE()) - YEAR(NGAYBC) AS[Năm BC] FROM NHANVIEN WHERE YEAR(GETDATE()) - YEAR(NGAYBC) > 10
-- 11
SELECT *, YEAR(GETDATE()) - YEAR(NGAYSINH) AS[Tuổi] FROM NHANVIEN WHERE (YEAR(GETDATE()) - YEAR(NGAYSINH) >= 60 AND GIOITINH = N'Nam') OR (YEAR(GETDATE()) - YEAR(NGAYSINH) >= 55 AND GIOITINH = N'Nữ') 
-- 12
SELECT MAPHONG, TENPHONG, TEL FROM PHONG
-- 13
SELECT TOP(2) HOTEN, NGAYSINH, NGAYBC FROM NHANVIEN
-- 14
SELECT MANV, HOTEN, NGAYSINH, LUONG FROM NHANVIEN WHERE LUONG BETWEEN 2000000 AND 3000000
-- 15
SELECT * FROM NHANVIEN WHERE SDT IS NULL
-- 16
SELECT * FROM NHANVIEN WHERE MONTH(NGAYSINH) = 3
-- 17 sắp theo tăng dần lương
SELECT * FROM NHANVIEN ORDER BY (LUONG)
-- 18
SELECT AVG(LUONG) AS [Lương TB phòng KD] FROM NHANVIEN LEFT JOIN PHONG ON NHANVIEN.MAPHONG = PHONG.MAPHONG WHERE TENPHONG = N'Kinh doanh'
-- 19
SELECT COUNT(*) AS [Tổng NV phòng KD],AVG(LUONG) AS [Lương TB phòng KD] FROM NHANVIEN LEFT JOIN PHONG ON NHANVIEN.MAPHONG = PHONG.MAPHONG WHERE TENPHONG = N'Kinh doanh'
-- 20
SELECT MAPHONG, SUM(LUONG) AS [Tổng Lương] FROM NHANVIEN GROUP BY MAPHONG
-- 21
SELECT MAPHONG, SUM(LUONG) AS [Tổng Lương] FROM NHANVIEN GROUP BY MAPHONG HAVING SUM(LUONG) > 5000000
-- 22
SELECT MANV, HOTEN, NHANVIEN.MAPHONG, TENPHONG FROM NHANVIEN LEFT JOIN PHONG ON NHANVIEN.MAPHONG = PHONG.MAPHONG
-- 23
SELECT * FROM NHANVIEN AS N LEFT JOIN PHONG AS P ON N.MAPHONG = P.MAPHONG
-- 24
SELECT * FROM PHONG AS P LEFT JOIN NHANVIEN AS N ON P.MAPHONG = N.MAPHONG
